WARNING:tensorflow:From /home/s3665828/.conda/envs/cascade/lib/python3.7/site-packages/tensorflow/python/ops/array_ops.py:5049: calling gather (from tensorflow.python.ops.array_ops) with validate_indices is deprecated and will be removed in a future version.
Instructions for updating:
The `validate_indices` argument has no effect. Indices are always validated on CPU and never validated on GPU.
/home/s3665828/.conda/envs/cascade/lib/python3.7/site-packages/tensorflow/python/keras/optimizer_v2/optimizer_v2.py:375: UserWarning: The `lr` argument is deprecated, use `learning_rate` instead.
  "The `lr` argument is deprecated, use `learning_rate` instead.")
WARNING:tensorflow:`period` argument is deprecated. Please use `save_freq` to specify the frequency in number of batches seen.
[34m[1mwandb[39m[22m: [33mWARNING[39m The save_model argument by default saves the model in the HDF5 format that cannot save custom objects like subclassed models and custom layers. This behavior will be deprecated in a future release in favor of the SavedModel format. Meanwhile, the HDF5 model is saved as W&B files and the SavedModel as W&B Artifacts.
/home/s3665828/.conda/envs/cascade/lib/python3.7/site-packages/tensorflow/python/keras/engine/training.py:1935: UserWarning: `Model.fit_generator` is deprecated and will be removed in a future version. Please use `Model.fit`, which supports generators.
  warnings.warn('`Model.fit_generator` is deprecated and '
Model: "graph_model"
__________________________________________________________________________________________________
Layer (type)                    Output Shape         Param #     Connected to
==================================================================================================
atom (InputLayer)               [(None, 1)]          0
__________________________________________________________________________________________________
squeeze (Squeeze)               (None,)              0           atom_index[0][0]
                                                                 atom[0][0]
                                                                 n_pro[0][0]
__________________________________________________________________________________________________
atom_embedding (Embedding)      (None, 256)          2560        squeeze[1][0]
__________________________________________________________________________________________________
dense (Dense)                   (None, 256)          65536       atom_embedding[0][0]
__________________________________________________________________________________________________
connectivity (InputLayer)       [(None, 2)]          0
__________________________________________________________________________________________________
gather_atom_to_bond (GatherAtom (None, 256)          0           dense[0][0]
                                                                 connectivity[0][0]
__________________________________________________________________________________________________
gather_atom_to_bond_1 (GatherAt (None, 256)          0           dense[0][0]
                                                                 connectivity[0][0]
__________________________________________________________________________________________________
distance_rbf (InputLayer)       [(None, 256)]        0
__________________________________________________________________________________________________
concatenate (Concatenate)       (None, 768)          0           gather_atom_to_bond[0][0]
                                                                 gather_atom_to_bond_1[0][0]
                                                                 distance_rbf[0][0]
__________________________________________________________________________________________________
dense_1 (Dense)                 (None, 512)          393728      concatenate[0][0]
__________________________________________________________________________________________________
dense_2 (Dense)                 (None, 256)          131328      dense_1[0][0]
__________________________________________________________________________________________________
dense_3 (Dense)                 (None, 256)          65792       dense_2[0][0]
__________________________________________________________________________________________________
dense_4 (Dense)                 (None, 256)          65792       dense_3[0][0]
__________________________________________________________________________________________________
add (Add)                       (None, 256)          0           dense_4[0][0]
                                                                 distance_rbf[0][0]
__________________________________________________________________________________________________
multiply (Multiply)             (None, 256)          0           gather_atom_to_bond[0][0]
                                                                 add[0][0]
__________________________________________________________________________________________________
reduce_bond_to_atom (ReduceBond (None, 256)          0           multiply[0][0]
                                                                 connectivity[0][0]
__________________________________________________________________________________________________
dense_5 (Dense)                 (None, 256)          65792       reduce_bond_to_atom[0][0]
__________________________________________________________________________________________________
dense_6 (Dense)                 (None, 256)          65792       dense_5[0][0]
__________________________________________________________________________________________________
add_1 (Add)                     (None, 256)          0           dense[0][0]
                                                                 dense_6[0][0]
__________________________________________________________________________________________________
dense_7 (Dense)                 (None, 256)          65536       add_1[0][0]
__________________________________________________________________________________________________
gather_atom_to_bond_2 (GatherAt (None, 256)          0           dense_7[0][0]
                                                                 connectivity[0][0]
__________________________________________________________________________________________________
gather_atom_to_bond_3 (GatherAt (None, 256)          0           dense_7[0][0]
                                                                 connectivity[0][0]
__________________________________________________________________________________________________
concatenate_1 (Concatenate)     (None, 768)          0           gather_atom_to_bond_2[0][0]
                                                                 gather_atom_to_bond_3[0][0]
                                                                 add[0][0]
__________________________________________________________________________________________________
dense_8 (Dense)                 (None, 512)          393728      concatenate_1[0][0]
__________________________________________________________________________________________________
dense_9 (Dense)                 (None, 256)          131328      dense_8[0][0]
__________________________________________________________________________________________________
dense_10 (Dense)                (None, 256)          65792       dense_9[0][0]
__________________________________________________________________________________________________
dense_11 (Dense)                (None, 256)          65792       dense_10[0][0]
__________________________________________________________________________________________________
add_2 (Add)                     (None, 256)          0           dense_11[0][0]
                                                                 add[0][0]
__________________________________________________________________________________________________
multiply_1 (Multiply)           (None, 256)          0           gather_atom_to_bond_2[0][0]
                                                                 add_2[0][0]
__________________________________________________________________________________________________
reduce_bond_to_atom_1 (ReduceBo (None, 256)          0           multiply_1[0][0]
                                                                 connectivity[0][0]
__________________________________________________________________________________________________
dense_12 (Dense)                (None, 256)          65792       reduce_bond_to_atom_1[0][0]
__________________________________________________________________________________________________
dense_13 (Dense)                (None, 256)          65792       dense_12[0][0]
__________________________________________________________________________________________________
add_3 (Add)                     (None, 256)          0           dense_7[0][0]
                                                                 dense_13[0][0]
__________________________________________________________________________________________________
dense_14 (Dense)                (None, 256)          65536       add_3[0][0]
__________________________________________________________________________________________________
gather_atom_to_bond_4 (GatherAt (None, 256)          0           dense_14[0][0]
                                                                 connectivity[0][0]
__________________________________________________________________________________________________
gather_atom_to_bond_5 (GatherAt (None, 256)          0           dense_14[0][0]
                                                                 connectivity[0][0]
__________________________________________________________________________________________________
concatenate_2 (Concatenate)     (None, 768)          0           gather_atom_to_bond_4[0][0]
                                                                 gather_atom_to_bond_5[0][0]
                                                                 add_2[0][0]
__________________________________________________________________________________________________
dense_15 (Dense)                (None, 512)          393728      concatenate_2[0][0]
__________________________________________________________________________________________________
dense_16 (Dense)                (None, 256)          131328      dense_15[0][0]
__________________________________________________________________________________________________
dense_17 (Dense)                (None, 256)          65792       dense_16[0][0]
__________________________________________________________________________________________________
dense_18 (Dense)                (None, 256)          65792       dense_17[0][0]
__________________________________________________________________________________________________
add_4 (Add)                     (None, 256)          0           dense_18[0][0]
                                                                 add_2[0][0]
__________________________________________________________________________________________________
multiply_2 (Multiply)           (None, 256)          0           gather_atom_to_bond_4[0][0]
                                                                 add_4[0][0]
__________________________________________________________________________________________________
reduce_bond_to_atom_2 (ReduceBo (None, 256)          0           multiply_2[0][0]
                                                                 connectivity[0][0]
__________________________________________________________________________________________________
dense_19 (Dense)                (None, 256)          65792       reduce_bond_to_atom_2[0][0]
__________________________________________________________________________________________________
dense_20 (Dense)                (None, 256)          65792       dense_19[0][0]
__________________________________________________________________________________________________
atom_index (InputLayer)         [(None, 1)]          0
__________________________________________________________________________________________________
n_pro (InputLayer)              [(None, 1)]          0
__________________________________________________________________________________________________
add_5 (Add)                     (None, 256)          0           dense_14[0][0]
                                                                 dense_20[0][0]
__________________________________________________________________________________________________
reduce_atom_to_pro (ReduceAtomT (None, 256)          0           add_5[0][0]
                                                                 squeeze[0][0]
                                                                 squeeze[2][0]
__________________________________________________________________________________________________
dense_21 (Dense)                (None, 256)          65792       reduce_atom_to_pro[0][0]
__________________________________________________________________________________________________
dense_22 (Dense)                (None, 256)          65792       dense_21[0][0]
__________________________________________________________________________________________________
dense_23 (Dense)                (None, 128)          32896       dense_22[0][0]
__________________________________________________________________________________________________
atomwise_shift (Embedding)      (None, 1)            10          squeeze[1][0]
__________________________________________________________________________________________________
dense_24 (Dense)                (None, 1)            129         dense_23[0][0]
__________________________________________________________________________________________________
reduce_atom_to_pro_1 (ReduceAto (None, 1)            0           atomwise_shift[0][0]
                                                                 squeeze[0][0]
                                                                 squeeze[2][0]
__________________________________________________________________________________________________
add_6 (Add)                     (None, 1)            0           dense_24[0][0]
                                                                 reduce_atom_to_pro_1[0][0]
==================================================================================================
Total params: 2,728,459
Trainable params: 2,728,459
Non-trainable params: 0
__________________________________________________________________________________________________
Epoch 1/1200
/home/s3665828/.conda/envs/cascade/lib/python3.7/site-packages/tensorflow/python/keras/engine/functional.py:591: UserWarning: Input dict contained keys ['bond', 'node_graph_indices'] which did not match any model input. They will be ignored by the model.
  [n for n in tensors.keys() if n not in ref_input_names])
/home/s3665828/.conda/envs/cascade/lib/python3.7/site-packages/tensorflow/python/framework/indexed_slices.py:449: UserWarning: Converting sparse IndexedSlices(IndexedSlices(indices=Tensor("gradient_tape/graph_model/gather_atom_to_bond_4/Reshape_1:0", shape=(None,), dtype=int32), values=Tensor("gradient_tape/graph_model/gather_atom_to_bond_4/Reshape:0", shape=(None, 256), dtype=float32), dense_shape=Tensor("gradient_tape/graph_model/gather_atom_to_bond_4/Cast:0", shape=(2,), dtype=int32))) to a dense Tensor of unknown shape. This may consume a large amount of memory.
  "shape. This may consume a large amount of memory." % value)
/home/s3665828/.conda/envs/cascade/lib/python3.7/site-packages/tensorflow/python/framework/indexed_slices.py:449: UserWarning: Converting sparse IndexedSlices(IndexedSlices(indices=Tensor("gradient_tape/graph_model/gather_atom_to_bond_5/Reshape_1:0", shape=(None,), dtype=int32), values=Tensor("gradient_tape/graph_model/gather_atom_to_bond_5/Reshape:0", shape=(None, 256), dtype=float32), dense_shape=Tensor("gradient_tape/graph_model/gather_atom_to_bond_5/Cast:0", shape=(2,), dtype=int32))) to a dense Tensor of unknown shape. This may consume a large amount of memory.
  "shape. This may consume a large amount of memory." % value)
/home/s3665828/.conda/envs/cascade/lib/python3.7/site-packages/tensorflow/python/framework/indexed_slices.py:449: UserWarning: Converting sparse IndexedSlices(IndexedSlices(indices=Tensor("gradient_tape/graph_model/gather_atom_to_bond_2/Reshape_1:0", shape=(None,), dtype=int32), values=Tensor("gradient_tape/graph_model/gather_atom_to_bond_2/Reshape:0", shape=(None, 256), dtype=float32), dense_shape=Tensor("gradient_tape/graph_model/gather_atom_to_bond_2/Cast:0", shape=(2,), dtype=int32))) to a dense Tensor of unknown shape. This may consume a large amount of memory.
  "shape. This may consume a large amount of memory." % value)
/home/s3665828/.conda/envs/cascade/lib/python3.7/site-packages/tensorflow/python/framework/indexed_slices.py:449: UserWarning: Converting sparse IndexedSlices(IndexedSlices(indices=Tensor("gradient_tape/graph_model/gather_atom_to_bond_3/Reshape_1:0", shape=(None,), dtype=int32), values=Tensor("gradient_tape/graph_model/gather_atom_to_bond_3/Reshape:0", shape=(None, 256), dtype=float32), dense_shape=Tensor("gradient_tape/graph_model/gather_atom_to_bond_3/Cast:0", shape=(2,), dtype=int32))) to a dense Tensor of unknown shape. This may consume a large amount of memory.
  "shape. This may consume a large amount of memory." % value)
/home/s3665828/.conda/envs/cascade/lib/python3.7/site-packages/tensorflow/python/framework/indexed_slices.py:449: UserWarning: Converting sparse IndexedSlices(IndexedSlices(indices=Tensor("gradient_tape/graph_model/gather_atom_to_bond/Reshape_1:0", shape=(None,), dtype=int32), values=Tensor("gradient_tape/graph_model/gather_atom_to_bond/Reshape:0", shape=(None, 256), dtype=float32), dense_shape=Tensor("gradient_tape/graph_model/gather_atom_to_bond/Cast:0", shape=(2,), dtype=int32))) to a dense Tensor of unknown shape. This may consume a large amount of memory.
  "shape. This may consume a large amount of memory." % value)
/home/s3665828/.conda/envs/cascade/lib/python3.7/site-packages/tensorflow/python/framework/indexed_slices.py:449: UserWarning: Converting sparse IndexedSlices(IndexedSlices(indices=Tensor("gradient_tape/graph_model/gather_atom_to_bond_1/Reshape_1:0", shape=(None,), dtype=int32), values=Tensor("gradient_tape/graph_model/gather_atom_to_bond_1/Reshape:0", shape=(None, 256), dtype=float32), dense_shape=Tensor("gradient_tape/graph_model/gather_atom_to_bond_1/Cast:0", shape=(2,), dtype=int32))) to a dense Tensor of unknown shape. This may consume a large amount of memory.
  "shape. This may consume a large amount of memory." % value)


  4/202 [..............................] - ETA: 3:25 - loss: 3906.8955
Traceback (most recent call last):
  File "graph_network.py", line 219, in <module>
    callbacks=[checkpoint, csv_logger, lr_decay, WandbCallback()])
  File "/home/s3665828/.conda/envs/cascade/lib/python3.7/site-packages/tensorflow/python/keras/engine/training.py", line 1952, in fit_generator
    initial_epoch=initial_epoch)
  File "/home/s3665828/.conda/envs/cascade/lib/python3.7/site-packages/wandb/integration/keras/keras.py", line 174, in new_v2
    return old_v2(*args, **kwargs)
  File "/home/s3665828/.conda/envs/cascade/lib/python3.7/site-packages/wandb/integration/keras/keras.py", line 174, in new_v2
    return old_v2(*args, **kwargs)
  File "/home/s3665828/.conda/envs/cascade/lib/python3.7/site-packages/wandb/integration/keras/keras.py", line 174, in new_v2
    return old_v2(*args, **kwargs)
  File "/home/s3665828/.conda/envs/cascade/lib/python3.7/site-packages/tensorflow/python/keras/engine/training.py", line 1178, in fit
    tmp_logs = self.train_function(iterator)
  File "/home/s3665828/.conda/envs/cascade/lib/python3.7/site-packages/tensorflow/python/eager/def_function.py", line 889, in __call__
    result = self._call(*args, **kwds)
  File "/home/s3665828/.conda/envs/cascade/lib/python3.7/site-packages/tensorflow/python/eager/def_function.py", line 917, in _call
    return self._stateless_fn(*args, **kwds)  # pylint: disable=not-callable
  File "/home/s3665828/.conda/envs/cascade/lib/python3.7/site-packages/tensorflow/python/eager/function.py", line 3024, in __call__
    filtered_flat_args, captured_inputs=graph_function.captured_inputs)  # pylint: disable=protected-access
  File "/home/s3665828/.conda/envs/cascade/lib/python3.7/site-packages/tensorflow/python/eager/function.py", line 1961, in _call_flat
    ctx, args, cancellation_manager=cancellation_manager))
  File "/home/s3665828/.conda/envs/cascade/lib/python3.7/site-packages/tensorflow/python/eager/function.py", line 596, in call
    ctx=ctx)
  File "/home/s3665828/.conda/envs/cascade/lib/python3.7/site-packages/tensorflow/python/eager/execute.py", line 60, in quick_execute
    inputs, attrs, num_outputs)
KeyboardInterrupt